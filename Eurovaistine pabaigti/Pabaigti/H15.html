<script>
    /*------ Params of test ----------*/
    var testName = "AB test EuroI2H15TDM - Sticky cart notification";
    var testID = "EuroI2H15TDM";
    var variationPercent = 51;
    // 101 - MAX only less (100%)
    // 1 - MIN more or equals (0%)
    // 51 - 50/50 (50%)
    /*--------------------------------*/

    AbTestRun(testID, testName, variationPercent);

    if (((xcookie("AB tests").indexOf("[" + testID + " : " + ABtestVariation + "]") != -1) || (variationPercent == 101)) && (xcookie("AB tests").indexOf("false") == -1)) {
        /* ------------ Variation UI/UX changes ----------------- */
        (function () {
            setTimeout(function () {
                function _findClosest(el, selector) {
                    var matchesFn;
                    [
                        "matches",
                        "webkitMatchesSelector",
                        "mozMatchesSelector",
                        "msMatchesSelector",
                        "oMatchesSelector",
                    ].some(function (fn) {
                        if (typeof document.body[fn] == "function") {
                            matchesFn = fn;
                            return true;
                        }
                        return false;
                    });
                    var parent;
                    while (el) {
                        parent = el.parentElement;
                        if (parent && parent[matchesFn](selector)) {
                            return parent;
                        }
                        el = parent;
                    }
                    return null;
                }

                var tablet = window.matchMedia("(max-width: 992px)");
                var smallDesktop = window.matchMedia("(max-width: 1200px)");
                var selector = {
                    topHeader: document.querySelector(".top"),
                    header: document.querySelector(".header"),
                    navbarCollapse: document.querySelector(".navbar-collapse"),
                    login: document.querySelector(".loggin-hdr"),
                };

                var productTitle = "";
                var imageUrl = "";
                var productPrice = "";
                var productCount = 1;
                var buyButtonText = "Peržiūrėti krepšelį";
                var returnToShopText = "Tęsti apsipirkimą";
                var productAdded = "Prekės <span class='new-mini-cart-count'>1</span> vnt. įdėta į krepšelį";

                if (document.querySelectorAll("#video-dialog-mobile").length > 0) {
                    document
                        .querySelector(".product-content button[data-handler='addToCart']")
                        .addEventListener("click", function () {
                            productTitle = document.querySelector(".product-content h1").innerText;
                            imageUrl = document.querySelector(".product-photo-image img").getAttribute("src");
                            productPrice = document.querySelector(".product-content .product-price-default").innerText;
                            productCount = document.querySelector(".product-content #sylius_order_item_quantity").value;

                            createCart();
                        });
                }

                var allAddToCart = document.querySelectorAll("#fbt-addtocart-button");
                allAddToCart.forEach(function (item, idx) {
                    item.addEventListener("click", function () {
                        var productName = document.querySelectorAll('#fbt-widget .bitrec-item')[1];

                        productTitle = productName.querySelector(".product-text").innerText;
                        imageUrl = productName.querySelector(".product-img img").getAttribute("src");
                        productPrice = productName.querySelector(".product-price-default").innerText;
                        if (productName.querySelector("#sylius_order_item_quantity")) {
                            productCount = productName.querySelector("#sylius_order_item_quantity").value;
                        }

                        createCart();
                    });
                });

                var allAddToCart = document.querySelectorAll(".product-item button[data-handler='addToCart']");
                allAddToCart.forEach(function (item, idx) {
                    item.addEventListener("click", function () {
                        var productName = _findClosest(this, ".product-item ");

                        productTitle = productName.querySelector(".product-text").innerText;
                        imageUrl = productName.querySelector(".product-img img").getAttribute("src");
                        productPrice = productName.querySelector(".product-price-default").innerText;
                        if (productName.querySelector("#sylius_order_item_quantity")) {
                            productCount = productName.querySelector("#sylius_order_item_quantity").value;
                        }

                        createCart();
                    });
                });

                function createCart() {
                    if (document.querySelectorAll(".new-mini-cart-wrap").length > 0) {
                        document.querySelector(".new-mini-cart-wrap").remove();
                    }

                    var htmldata =
                        '<div class="new-mini-cart-header">' +
                        productAdded +
                        '<span class="new-mini-cart-close"></span></div><div class="new-mini-cart-body"><div class="new-mini-cart-img"><img src="' +
                        imageUrl +
                        '" title="" alt="" /></div><div class="new-mini-cart-txt"><div class="new-mini-cart-name">' +
                        productTitle +
                        '</div><div class="new-mini-cart-price">' +
                        productPrice +
                        '</div></div></div><div class="new-mini-cart-bottom"><button class="new-mini-cart-ok">' +
                        buyButtonText +
                        '</button><button class="new-mini-cart-back">' +
                        returnToShopText +
                        "</button></div>";
                    var newMiniCart = document.createElement("div");
                    newMiniCart.setAttribute("class", "new-mini-cart-wrap");
                    newMiniCart.innerHTML = htmldata;
                    document.querySelector(".header .header-wrapper").appendChild(newMiniCart);
                    if (window.pageYOffset < 20) {
                        document.querySelector(".new-mini-cart-wrap").classList.add("initial-top-position");
                    }

                    document.querySelector(".new-mini-cart-ok").addEventListener("click", function () {
                        window.location = "/krepselis";
                    });
                    document.querySelector(".new-mini-cart-close").addEventListener("click", function () {
                        destroyCart();
                    });
                    document.querySelector(".new-mini-cart-back").addEventListener("click", function () {
                        destroyCart();
                    });
                    document.querySelector(".new-mini-cart-count").innerText = productCount;
                    //   hj("trigger", "ab_test_EuroI1H8TDM_var1");
                }

                function destroyCart() {
                    document.querySelector(".new-mini-cart-wrap").remove();
                }

                var prevScrollpos = window.pageYOffset;

                window.onscroll = function () {
                    var currentScrollPos = window.pageYOffset;
                    if (currentScrollPos > 20 && document.querySelector(".new-mini-cart-wrap")) {
                        document.querySelector(".new-mini-cart-wrap").classList.remove("initial-top-position");
                    }

                    if (prevScrollpos < currentScrollPos) {
                        if (document.querySelector(".new-mini-cart-wrap.scrolled")) {
                            document.querySelector(".new-mini-cart-wrap").classList.remove("scrolled");
                        }
                    } else if (currentScrollPos < 40 && document.querySelector(".new-mini-cart-wrap")) {
                        document.querySelector(".new-mini-cart-wrap").classList.add("scrolled");
                    }

                    // Code to activate Sticky Header scrolling when this test is active
                    var headerTop = function () {
                        if (tablet.matches) {
                            return "54px";
                        } else if (smallDesktop.matches) {
                            return "69px";
                        }

                        return "39px";
                    };

                    var headerScrolled = function () {
                        if (tablet.matches) {
                            return "-15px";
                        } else if (smallDesktop.matches) {
                            return "0";
                        }
                        return "0";
                    };

                    var navTop = function () {
                        if (tablet.matches) {
                            return "143px";
                        } else if (smallDesktop.matches) {
                            return "184px";
                        }

                        return "144px";
                    };

                    var navScrolled = function () {
                        if (tablet.matches) {
                            return "69px";
                        } else if (smallDesktop.matches) {
                            return "69px";
                        }

                        return "69px";
                    };

                    var navHidden = function () {
                        if (tablet.matches) {
                            return "16px";
                        } else if (smallDesktop.matches) {
                        }

                        return "16px";
                    };

                    if (currentScrollPos < 10) {
                        selector.header.style.top = headerTop();
                        selector.header.classList.remove("header-scrolled");
                        selector.login.classList.remove("fa");
                        selector.login.classList.add("fal");
                    } else {
                        selector.header.style.top = headerScrolled();
                        selector.header.classList.add("header-scrolled");
                        selector.login.classList.remove("fal");
                        selector.login.classList.add("fa");
                    }
                    if (currentScrollPos < 10) {
                        selector.navbarCollapse.style.top = navTop();
                    }

                    if (prevScrollpos > currentScrollPos) {
                        if (currentScrollPos < 10) {
                            selector.navbarCollapse.style.top = navTop();
                        } else {
                            selector.navbarCollapse.style.top = navScrolled();
                        }
                    } else {
                        if (currentScrollPos < 10) {
                            selector.navbarCollapse.style.top = navTop();
                        } else {
                            selector.navbarCollapse.style.top = navHidden();
                        }
                    }
                    // End

                    prevScrollpos = currentScrollPos;
                };
            }, 2000)
            var css =
                '.header-wrapper{position:relative}.new-mini-cart-img{width:35%;min-width:35%}.new-mini-cart-img img{width:100%}.new-mini-cart-txt{width:65%;min-width:65%;padding:10px 16px 0 0}.new-mini-cart-name{color:#01a652}.new-mini-cart-price{color:#41413e;font-size:20px;font-weight:700;line-height:100%;margin-top:12px}.new-mini-cart-close{position:absolute;top:10px;right:10px;width:20px;height:20px;cursor:pointer}.new-mini-cart-close:after,.new-mini-cart-close:before{content:"";width:16px;height:2px;background:#fff;top:4px;left:0;display:block;position:absolute}.new-mini-cart-close:before{transform:rotate(45deg)}.new-mini-cart-close:after{transform:rotate(135deg)}.new-mini-cart-wrap:before{content:"";display:block;width:0;height:0;border-style:solid;border-width:0 10px 15px 10px;border-color:transparent transparent #878787 transparent;position:absolute;top:-15px;left:170px}.cart-message.top-message.top-message-warning{display:none!important}.header-wrapper{position:relative}.new-mini-cart-wrap{transition:top .3s ease-in-out;width:100%;max-width:280px;min-width:280px;border-radius:4px;border:1px solid #878787;background:#fff;position:fixed;top:30px;right:0;z-index:11111111;box-shadow:0 160px 80px 40px #00000070}',
                head = document.head || document.getElementsByTagName("head")[0],
                style = document.createElement("style");
            css += '@media (min-width:768px){.sticky-main-navigation .new-mini-cart-wrap{position:absolute;top:70px;right:-15px}.new-mini-cart-wrap{box-shadow:0 0 40px #00000070}.new-mini-cart-wrap.scrolled{top:60px;position:absolute}.sticky-main-navigation .new-mini-cart-wrap.scrolled{top:50px;right:-20px}.new-mini-cart-wrap.initial-top-position{position:absolute;top:60px;right:-20px}}@media (min-width:992px){.new-mini-cart-wrap{top:20px;right:10px}.new-mini-cart-wrap.initial-top-position{top:60px;right:20px}.sticky-main-navigation .new-mini-cart-wrap{top:60px;right:-40px}.sticky-main-navigation .new-mini-cart-wrap.scrolled{right:20px;top:60px}}.new-mini-cart-header{position:relative;background:#878787;text-align:center;color:#fff;font-weight:600;padding:8px;text-transform:uppercase;font-size:12px}.new-mini-cart-bottom{padding:10px 20px}.new-mini-cart-ok{font-weight:700;font-size:13px;background:#01a652;border:none;color:#fff;border-radius:4px;padding:8px;width:100%}.new-mini-cart-back{border:none;background:0 0;text-align:center;width:100%;color:#878787;margin:10px 0 4px;font-size:12px}'
            css +=
                '.new-mini-cart-ok:after{content:"";border-bottom:1px solid #fff;border-right:1px solid #fff;display:inline-block;width:8px;height:8px;transform:rotate(-45deg);margin-left:7px}.new-mini-cart-back:before{content:"";border-bottom:1px solid #616159;border-right:1px solid #616159;display:inline-block;width:8px;height:8px;transform:rotate(135deg);margin-right:7px}.new-mini-cart-body{display:flex;justify-content:space-between;align-items:center;padding:16px 0 16px}@media (max-width:767px){.new-mini-cart-wrap{position:fixed;top:46px;left:0;width:100%;max-width:100%;border-radius:0;box-shadow:0 5px 10px #00000070;min-height:221px}.new-mini-cart-wrap::after{content:"";position:absolute;z-index:-1;top:220px;left:0;right:0;bottom:0;width:100vw;height:100vh;background:rgb(0 0 0 / .3)}.new-mini-cart-header{background:#d0fee7;color:#16ae61;border-bottom:1px solid #16ae61;border-radius:0}.new-mini-cart-close:after,.new-mini-cart-close:before{background:#16ae61}.new-mini-cart-body{max-width:340px;margin:0 auto;padding:10px 0 4px}.new-mini-cart-bottom{max-width:380px;margin:0 auto;display:flex;justify-content:space-between;align-items:center;flex-direction:row-reverse}.new-mini-cart-ok{margin-left:4px;line-height:100%;padding:10px 6px}.new-mini-cart-back{border:1px solid #616159;border-radius:4px;padding:8px 6px;margin:0;margin-right:4px}.new-mini-cart-wrap:before{content:none}.new-mini-cart-back:before,.new-mini-cart-ok:after{content:none}.top--wrapper.no-mobile{display:block!important;height:0}}';


            style.type = "text/css";
            if (style.styleSheet) {
                // This is required for IE8 and below.
                style.styleSheet.cssText = css;
            } else {
                style.appendChild(document.createTextNode(css));
            }
            head.appendChild(style);
        })();
        /* ------------------------------------------------------ */
    } 
</script>